## @noparams
#set($tagListPage = $pageManager.getPage(326271087))

<script>
    function newTaxonomyTerm(tN, tV){
        var newTerm = {
            termName : tN,
            termValue : tV
        };
        return newTerm;
    }

    function newTaxonomy(){
        var taxonomy = {
            terms:[],
            labels:[],
            insertTerm : function(taxTerm){
               this.terms.push(taxTerm);
               this.labels.push(taxTerm.termValue);
            },
            getTermName : function(termLabel){
                var labelIdx = this.labels.indexOf(termLabel);
                if (labelIdx > -1) return this.terms[labelIdx].termName;
              }
        };
        return taxonomy;
    }
    var taxonomy = newTaxonomy();

    function extractInfo(infoLine, index, array){
        var re = /\<td\>(.+)?\<\/td\>\<td\>(.+)\<\/td\>/;
        var vals = re.exec(infoLine);
        if (vals) {
         termName = vals[1];
         confluenceLabel = vals[2];
         var newTerm = newTaxonomyTerm(termName, confluenceLabel);
         taxonomy.insertTerm(newTerm);
        }
    }

    $(document).ready(function(){
    	var rawContent = '$tagListPage.getBodyAsString()';
	var re = /(\<table.+\<\/table\>)/;
	 rawContent = re.exec(rawContent.slice(
                 rawContent.indexOf("taxonomy") + 8,
                 rawContent.indexOf("/taxonomy") ))[1];

      //var rawContent now contains the html
      //of the table with id "taxonomy"
      rawInfo =  rawContent.split("</tr>");
      rawInfo.forEach(extractInfo);
      console.log(taxonomy);
    });

</script>
